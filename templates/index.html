<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cat Tracker App</title>
  <style>
    body { font-family: Arial; text-align: center; background-color: #f5f5f5; }
    h1 { color: #333; }
    video, img { border: 2px solid #333; border-radius: 8px; }
    .controls { margin-top: 20px; }
    button, select {
      margin: 5px; padding: 10px 15px;
      font-size: 16px; border-radius: 6px;
    }
    .toggle-btn {
      color: white;
      border: none;
      cursor: pointer;
    }
    .enabled {
      background-color: green;
    }
    .disabled {
      background-color: gray;
    }
    #statusLabel {
      display: inline-block;
      margin-left: 10px;
      font-weight: bold;
      font-size: 16px;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <h1>Real-time Cat Tracker üêæ</h1>
  <img id="video-stream" src="{{ url_for('video_feed') }}" width="640" height="480">

  <div class="controls">
    <h3>Ch·ªçn ngu·ªìn video</h3>
    <select id="source-select">
      <option value="0">Webcam</option>
      <option value="rtsp://example.com/stream">RTSP Stream</option>
      <option value="video.mp4">Video file</option>
    </select>
    <button onclick="changeSource()">ƒê·ªïi ngu·ªìn</button>

    <h3>ƒêi·ªÅu khi·ªÉn m√¥ h√¨nh</h3>
    <button id="toggleBtn" class="toggle-btn">B·∫≠t/T·∫Øt Ph√°t hi·ªán</button>
    <span id="statusLabel">ƒêang t·∫£i...</span>
  </div>

  <script>
    const toggleBtn = document.getElementById("toggleBtn");
    const statusLabel = document.getElementById("statusLabel");

    function updateUI(isEnabled) {
      if (isEnabled) {
        toggleBtn.classList.remove("disabled");
        toggleBtn.classList.add("enabled");
        statusLabel.textContent = "üöÄ Ph√°t hi·ªán ƒëang B·∫¨T";
      } else {
        toggleBtn.classList.remove("enabled");
        toggleBtn.classList.add("disabled");
        statusLabel.textContent = "üõë Ph√°t hi·ªán ƒëang T·∫ÆT";
      }
    }

    async function toggleDetection() {
      const res = await fetch('/toggle_detection', { method: 'POST' });
      const data = await res.json();
      updateUI(data.enabled);
    }

    function changeSource() {
      const src = document.getElementById('source-select').value;
      fetch('/set_source', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({source: src})
      }).then(res => {
        if (res.ok) alert("Ngu·ªìn ƒë√£ ƒë·ªïi th√†nh c√¥ng!");
        else alert("L·ªói ƒë·ªïi ngu·ªìn!");
      });
    }

    // G·ªçi 1 l·∫ßn khi t·∫£i trang ƒë·ªÉ hi·ªÉn th·ªã tr·∫°ng th√°i ƒë√∫ng
    fetch('/status')
      .then(res => res.json())
      .then(data => updateUI(data.enabled));

    toggleBtn.onclick = toggleDetection;

    // K·∫øt n·ªëi WebSocket ƒë·ªÉ nh·∫≠n tr·∫°ng th√°i t·ª± ƒë·ªông
    const socket = new WebSocket(`ws://${location.host}/ws/status`);
    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      updateUI(data.enabled);
    };
  </script>
</body>
</html>
